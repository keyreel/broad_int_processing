# Broadcast Log Monitor

Этот скрипт на Python отслеживает первую строку указанного входного файла (`broad.int` по умолчанию), извлекает из нее
путь к файлу, обрабатывает его и записывает результат (имя файла без расширения или строку по умолчанию) в выходной
файл (`broad_out.txt` по умолчанию). Скрипт работает в бесконечном цикле с заданной паузой и предназначен для ситуаций,
когда входной файл часто перезаписывается другой программой, а выходной файл читается другой программой.

## Возможности

* **Непрерывный мониторинг:** Работает в цикле с настраиваемой паузой.
* **Извлечение пути:** Находит путь к файлу в строке, начиная с заданной позиции, и определяет его конец по известному
  расширению файла.
* **Обработка исключений:** Сравнивает найденный путь со списком подстрок-исключений. Если найдено совпадение (например,
  путь содержит `\Jingles\`), используется строка по умолчанию.
* **Атомарная запись:** Записывает результат в выходной файл с использованием временного файла и `os.replace()`. Это
  гарантирует, что программа, читающая выходной файл, всегда увидит либо старую, либо новую версию целиком, без риска
  прочитать пустой или неполный файл.
* **Устойчивость к ошибкам:** Обрабатывает ошибки чтения входного файла (которые ожидаемы, если файл перезаписывается) и
  ошибки записи, продолжая работу.
* **Конфигурация:** Все основные параметры (имена файлов, позиция пути, исключения, строка по умолчанию, пауза,
  кодировки) задаются переменными в начале скрипта.
* **Информативный вывод:** Отображает текущее записанное значение в консоли в одной перезаписываемой строке. Ошибки
  выводятся на отдельных строках.
* **Чистый выход:** Корректно завершает работу по нажатию `Ctrl+C`.

## Конфигурация

Основные параметры настраиваются в секции `# --- Конфигурация ---` в файле `main.py`:

* `INPUT_FILENAME`: Имя входного файла лога.
* `OUTPUT_FILENAME`: Имя выходного файла для результата.
* `EXCEPTION_SUBSTRINGS`: Список строк, наличие которых в пути файла приводит к использованию строки по умолчанию.
* `DEFAULT_OUTPUT_STRING`: Строка, записываемая в выходной файл при ошибках или если путь попал в исключения.
* `FILENAME_START_POS`: Начальная позиция (индекс с 0) пути файла во входной строке.
* `KNOWN_EXTENSIONS`: Список расширений файлов для поиска конца пути.
* `LOOP_PAUSE_SECONDS`: Пауза между циклами проверки (в секундах).
* `INPUT_ENCODING`: Кодировка входного файла.
* `OUTPUT_ENCODING`: Кодировка выходного файла.
* `CONSOLE_OUTPUT_PREFIX`: Текст перед выводом текущего значения в консоль.

## Запуск

1. Убедитесь, что у вас установлен Python 3.3 или выше (для `shutil.get_terminal_size` и `os.replace`).
2. Поместите скрипт `main.py` в нужную директорию.
3. Убедитесь, что входной файл (`broad.int` или указанный вами) будет создаваться/обновляться в той же директории или
   укажите полный путь.
4. Запустите скрипт из командной строки:
   ```bash
   python main.py
   ```
5. Скрипт начнет работу и будет выводить текущее записанное значение в консоль.
6. Для остановки скрипта нажмите `Ctrl+C`.

## Зависимости

Скрипт использует только стандартные библиотеки Python (`os`, `time`, `sys`, `shutil`). Никаких внешних зависимостей
устанавливать не нужно.

## Поддержка

Скрипт распространяется "как есть". Если у вас есть вопросы или предложения, вы можете создать issue в репозитории (но
лучше напишите в чате - ссылка ниже).

## Другие проекты

Телеграм-бот, присылающий уведомление при падении потока интернет-радио: https://t.me/stream_checker_bot

Подписывайтесь на канал, посвящённый радио и работе со звуком: https://t.me/RadioChannel

Обсудить работу скрипта и другие вопросы связанные с радиовещанием или работой со звуком можно в
чате https://t.me/RadioChannel_chat

## Лицензия

Этот проект распространяется под лицензией MIT. 